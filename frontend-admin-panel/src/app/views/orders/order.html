<div id="order" class="top-buffer-1">
  <a ui-sref="dashboard.orders" class="text-muted">
    <i class="fa fa-chevron-left"></i>&nbsp;<span translate>mnoe_admin_panel.dashboard.order.back</span>
  </a>
  <div class="row">
    <div class="col-xs-12">
      <mno-widget icon="fa-user-o" heading="{{'mnoe_admin_panel.dashboard.order.customer' | translate}}" is-loading="vm.isLoading">
        <mno-widget-header></mno-widget-header>
        <mno-widget-body>
          <div class="row">
            <div class="col-xs-4">
              <div class="label-cell" translate>mnoe_admin_panel.dashboard.order.name</div>
            </div>
            <div class="col-xs-8">
              {{vm.user.name}} {{vm.user.surname}}
            </div>
          </div>
          <div class="row">
            <div class="col-xs-4">
              <div class="label-cell" translate>mnoe_admin_panel.dashboard.order.email</div>
            </div>
            <div class="col-xs-8">
              {{vm.user.email}}
            </div>
          </div>
          <div class="row">
            <div class="col-xs-4">
              <div class="label-cell" translate>mnoe_admin_panel.dashboard.order.organization</div>
            </div>
            <div class="col-xs-8">
              {{vm.organization.name}}
            </div>
          </div>
        </mno-widget-body>
      </mno-widget>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-6">
      <mno-widget icon="fa-shopping-basket" heading="{{'mnoe_admin_panel.dashboard.subscription.subscription_info' | translate}}" is-loading="vm.isLoading">
        <mno-widget-header></mno-widget-header>
        <mno-widget-body>
          <div class="row">
            <div class="col-xs-6">
              <div class="label-cell" translate>mnoe_admin_panel.dashboard.subscription.reference</div>
            </div>
            <div class="col-xs-6">
              {{vm.subscription.external_id}}
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6">
              <div class="label-cell" translate>mnoe_admin_panel.dashboard.subscription.start_date</div>
            </div>
            <div class="col-xs-6">
              {{vm.subscription.start_date | date: 'dd/MM/yyyy'}}
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6">
              <div class="label-cell" translate>mnoe_admin_panel.dashboard.subscription.end_date</div>
            </div>
            <div class="col-xs-6">
              {{vm.subscription.end_date | date: 'dd/MM/yyyy'}}
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6">
              <div class="label-cell" translate>mnoe_admin_panel.dashboard.subscription.product</div>
            </div>
            <div class="col-xs-6">
              {{vm.subscription.product.name}}
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6">
              <div class="label-cell" translate>mnoe_admin_panel.dashboard.subscription.pricing_plan</div>
            </div>
            <div class="col-xs-6">
              {{vm.subscription.product_pricing.name}}
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6">
              <div class="label-cell" translate>mnoe_admin_panel.dashboard.subscription.price</div>
            </div>
            <div class="col-xs-6">
              <mnoe-product-pricing-prices subscription="vm.subscription" selected-currency="vm.subscription.currency">
            </div>
          </div>
          <div class="row" ng-show="vm.subscription.product_pricing.license_based">
            <div class="col-xs-6">
              <div class="label-cell" translate>mnoe_admin_panel.dashboard.subscription.licenses</div>
            </div>
            <div class="col-xs-6">
              {{vm.subscription.max_licenses}}
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6">
              <div class="label-cell" translate>mnoe_admin_panel.dashboard.subscription.status</div>
            </div>
            <div class="col-xs-6">
              {{vm.subscription.status}}
              <a class="label-cell" href="" ng-hide="!vm.displayInfoTooltip()" ng-click="vm.displayStatusInfo()"><i class="fa fa-info-circle"></i></a>
            </div>
          </div>
        </mno-widget-body>
      </mno-widget>
    </div>
    <div class="col-xs-6">
      <mno-widget icon="fa-shopping-basket" heading="{{'mnoe_admin_panel.dashboard.subscription.order_info' | translate}}" is-loading="vm.isLoading">
        <mno-widget-header></mno-widget-header>
        <mno-widget-body class="medium">
          <div ng-if="!vm.order" translate>
            mnoe_admin_panel.dashboard.order.no_order
          </div>
          <div ng-if="vm.order">
            <div class="row">
              <div class="col-xs-6">
                <div class="label-cell" translate>mnoe_admin_panel.dashboard.order.date</div>
              </div>
              <div class="col-xs-6">
                {{vm.order.created_at | date: 'dd/MM/yyyy'}}
              </div>
            </div>
            <div class="row">
              <div class="col-xs-6">
                <div class="label-cell" translate>mnoe_admin_panel.dashboard.order.order_type</div>
              </div>
              <div class="col-xs-6">
                {{vm.order.event_type}}
              </div>
            </div>
            <div class="row">
              <div class="col-xs-6">
                <div class="label-cell" translate>mnoe_admin_panel.dashboard.subscription.pricing_plan</div>
              </div>
              <div class="col-xs-6">
                {{vm.order.product_pricing.name}}
              </div>
            </div>
            <div class="row">
              <div class="col-xs-6">
                <div class="label-cell" translate>mnoe_admin_panel.dashboard.subscription.price</div>
              </div>
              <div class="col-xs-6">
                <mnoe-product-pricing-prices subscription="vm.order" selected-currency="vm.order.subscription_details.currency">
              </div>
            </div>
            <div class="row" ng-show="vm.subscription.product_pricing.license_based">
              <div class="col-xs-6">
                <div class="label-cell" translate>mnoe_admin_panel.dashboard.subscription.licenses</div>
              </div>
              <div class="col-xs-6">
                {{vm.order.subscription_details.max_licenses}}
              </div>
            </div>
            <div class="row">
              <div class="col-xs-6">
                <div class="label-cell" translate>mnoe_admin_panel.dashboard.order.status</div>
              </div>
              <div class="col-xs-6">
                {{vm.order.status}}
                <a class="label-cell" href="" ng-hide="!vm.displayInfoTooltip()" ng-click="vm.displayStatusInfo()"><i class="fa fa-info-circle"></i></a>
              </div>
            </div>
            <div class="row">
              <div class="col-xs-6">
                <div class="label-cell" translate>mnoe_admin_panel.dashboard.order.message</div>
              </div>
              <div class="col-xs-6">
                {{vm.order.message}}
              </div>
            </div>
            <div class="row">
              <div class="col-xs-6">
                <div class="label-cell" translate>mnoe_admin_panel.dashboard.order.approval</div>
              </div>
              <div class="col-xs-3">
                <button role="button" ng-click="vm.approveOrder()" ng-disabled="vm.disableApproval() || vm.isAccountManager" class="btn btn-primary btn-xs" translate>
                  mnoe_admin_panel.dashboard.order.approve
                </button>
              </div>
              <div class="col-xs-3">
                <button role="button" ng-click="vm.cancelOrder()" ng-disabled="vm.disableCancel() || vm.isAccountManager" class="btn btn-primary btn-xs" translate>
                  mnoe_admin_panel.dashboard.order.reject
                </button>
              </div>
            </div>
            <div class="row">
              <div class="col-xs-6">
              </div>
              <div class="col-xs-6">
                {{vm.orderWorkflowExplanation() | translate}}
              </div>
            </div>
          </div>
        </mno-widget-body>
      </mno-widget>
    </div>
  </div>
  <div class='row'>
    <div class="col-xs-6">
      <mno-widget icon="fa-info-circle" heading="{{'mnoe_admin_panel.dashboard.subscription.custom_data' | translate}}" is-loading="vm.isLoading">
        <mno-widget-header></mno-widget-header>
        <mno-widget-body>
          <span ng-show="vm.showNoDetailsProvied(vm.subscription.custom_data)" translate>mnoe_admin_panel.dashboard.order.no_custom_data</span>
          <form ng-if="!vm.enableBSEditor && vm.subscription.custom_data" name="vm.detailsForm" sf-schema="vm.schema" sf-form="vm.form" sf-model="vm.subscription.custom_data" sf-options="{ formDefaults: { readonly: { true } }}"></form>
          <section ng-if="vm.showBSReadOnlyForm(vm.subscription.custom_data)" class='editor-json-form'>
            <blue-sky-json-summary
              editor="vm.curSubEditor"
              target-object="vm.curSubConfig">
            </blue-sky-json-summary>
          </section>
        </mno-widget-body>
      </mno-widget>
    </div>
    <div class="col-xs-6">
      <mno-widget icon="fa-info-circle" heading="{{'mnoe_admin_panel.dashboard.order.custom_data' | translate}}" is-loading="vm.isLoading">
        <mno-widget-header></mno-widget-header>
        <mno-widget-body>
          <span ng-show="vm.showNoDetailsProvied(vm.order.subscription_details.custom_data)" translate>mnoe_admin_panel.dashboard.order.no_custom_data</span>
          <form ng-if="!vm.enableBSEditor && vm.order.subscription_details.custom_data" name="vm.detailsForm" sf-schema="vm.schema" sf-form="vm.form" sf-model="vm.order.subscription_details.custom_data" sf-options="{ formDefaults: { readonly: { true } }}"></form>
          <section ng-if="vm.showBSReadOnlyForm(vm.order.subscription_details.custom_data)" class='editor-json-form'>
            <blue-sky-json-summary
              editor="vm.reqSubEditor"
              target-object="vm.reqOrderConfig">
            </blue-sky-json-summary>
          </section>
        </mno-widget-body>
      </mno-widget>
    </div>
  </div>
  <div class="row">
    <div class='col-xs-6'>
      <mno-widget icon="fa-info-circle" heading="{{'mnoe_admin_panel.dashboard.orders.provision.subscription.events' | translate}}" is-loading="vm.isLoading">
        <mno-widget-header></mno-widget-header>
        <mno-widget-body>
          <span ng-show="vm.subscriptionEvents.length == 0" translate>
            mnoe_admin_panel.dashboard.orders.provision.subscription.no_events
          </span>
          <table class="table table-striped table-responsive" >
            <thead>
              <tr>
                <th class="col-lg-3" translate>
                  mnoe_admin_panel.dashboard.subscriptions.events.list.table.created_date
                </th>
                <th class="col-lg-3" translate>
                  mnoe_admin_panel.dashboard.subscriptions.events.list.table.event_type
                </th>
                <th class="col-lg-3" translate>
                  mnoe_admin_panel.dashboard.subscriptions.events.list.table.status
                </th>
                <th class="col-lg-3" translate>
                  mnoe_admin_panel.dashboard.subscriptions.events.list.table.message
                </th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="subscriptionEvent in vm.subscriptionEvents" ng-click="vm.openSubscriptionEventInfoModal(subscriptionEvent, vm.subscription)">
                <td>{{ subscriptionEvent.created_at | amDateFormat: 'L' }}</td>
                <td>{{ subscriptionEvent.event_type }}</td>
                <td>{{ subscriptionEvent.status }}</td>
                <td>{{ subscriptionEvent.message }}</td>
              </tr>
            </tbody>
          </table>
        </mno-widget-body>
      </mno-widget>
    </div>
    <div class="col-xs-6">
      <mno-widget icon="fa-info-circle" heading="{{'mnoe_admin_panel.dashboard.order.provisioning_data' | translate}}" is-loading="vm.isLoading">
        <mno-widget-header></mno-widget-header>
        <mno-widget-body>
          <span ng-if="!vm.subscription.provisioning_data" translate>mnoe_admin_panel.dashboard.order.no_provisioning_data</span>
          <user-friendly-json-tree ng-if="vm.subscription.provisioning_data" start-expanded="true" object="vm.subscription.provisioning_data" options="vm.jsonTreeSettings" root-name="vm.rootName"></user-friendly-json-tree>
        </mno-widget-body>
      </mno-widget>
    </div>
  </div>
</div>

<div ng-if="vm.loadHiddenEditor" class='hidden'>
  <section class="editor-wrapper">
    <blue-sky-json-editor
      schema-name="vm.subscription.product.external_id"
      schema="vm.currentSchemaDetails.schema"
      heading="true"
      scrollable="true"
      editor="vm.currentSchemaDetails.editor"
      initial-values="vm.subscriptionCopy">
    </blue-sky-json-editor>
  </section>
  <div ng-if="vm.currentSchemaDetails.editor">
    {{vm.setReadOnlyFormVars('currentSubscription')}}
  </div>

  <section class="editor-wrapper">
    <blue-sky-json-editor
      schema-name="vm.subscription.product.external_id"
      schema="vm.requestedSchemaDetails.schema"
      heading="true"
      scrollable="true"
      editor="vm.requestedSchemaDetails.editor"
      initial-values="vm.orderCopy">
    </blue-sky-json-editor>
  </section>
  <div ng-if="vm.requestedSchemaDetails.editor">
    {{vm.setReadOnlyFormVars('requestedOrder')}}
  </div>
</div>
